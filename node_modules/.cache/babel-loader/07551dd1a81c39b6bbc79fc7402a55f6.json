{"ast":null,"code":"'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _filter2 = require('lodash/filter');\n\nvar _filter3 = _interopRequireDefault(_filter2);\n\nvar _split2 = require('lodash/split');\n\nvar _split3 = _interopRequireDefault(_split2);\n\nvar _isString2 = require('lodash/isString');\n\nvar _isString3 = _interopRequireDefault(_isString2);\n\nvar _first2 = require('lodash/first');\n\nvar _first3 = _interopRequireDefault(_first2);\n\nvar _isEmpty2 = require('lodash/isEmpty');\n\nvar _isEmpty3 = _interopRequireDefault(_isEmpty2);\n\nvar _forIn2 = require('lodash/forIn');\n\nvar _forIn3 = _interopRequireDefault(_forIn2);\n\nvar _isFunction2 = require('lodash/isFunction');\n\nvar _isFunction3 = _interopRequireDefault(_isFunction2);\n\nvar _createClass = function () {\n  function defineProperties(target, props) {\n    for (var i = 0; i < props.length; i++) {\n      var descriptor = props[i];\n      descriptor.enumerable = descriptor.enumerable || false;\n      descriptor.configurable = true;\n      if (\"value\" in descriptor) descriptor.writable = true;\n      Object.defineProperty(target, descriptor.key, descriptor);\n    }\n  }\n\n  return function (Constructor, protoProps, staticProps) {\n    if (protoProps) defineProperties(Constructor.prototype, protoProps);\n    if (staticProps) defineProperties(Constructor, staticProps);\n    return Constructor;\n  };\n}();\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    default: obj\n  };\n}\n\nfunction _defineProperty(obj, key, value) {\n  if (key in obj) {\n    Object.defineProperty(obj, key, {\n      value: value,\n      enumerable: true,\n      configurable: true,\n      writable: true\n    });\n  } else {\n    obj[key] = value;\n  }\n\n  return obj;\n}\n\nfunction _classCallCheck(instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n}\n/**\n  Declarative Validation Rules\n\n    const plugins = {\n      dvr: dvr({\n        package: validatorjs,\n        extend: callback,\n      }),\n    };\n\n*/\n\n\nvar DVR = function () {\n  function DVR(_ref) {\n    var _ref$config = _ref.config,\n        config = _ref$config === undefined ? {} : _ref$config,\n        _ref$state = _ref.state,\n        state = _ref$state === undefined ? {} : _ref$state,\n        _ref$promises = _ref.promises,\n        promises = _ref$promises === undefined ? [] : _ref$promises;\n\n    _classCallCheck(this, DVR);\n\n    this.promises = [];\n    this.config = null;\n    this.state = null;\n    this.extend = null;\n    this.validator = null;\n    this.state = state;\n    this.promises = promises;\n    this.extend = config.extend;\n    this.validator = config.package || config;\n    this.extendValidator();\n  }\n\n  _createClass(DVR, [{\n    key: 'extendValidator',\n    value: function extendValidator() {\n      // extend using \"extend\" callback\n      if ((0, _isFunction3.default)(this.extend)) {\n        this.extend({\n          validator: this.validator,\n          form: this.state.form\n        });\n      }\n    }\n  }, {\n    key: 'validateField',\n    value: function validateField(field) {\n      // get form fields data\n      var data = this.state.form.validatedValues;\n      this.validateFieldAsync(field, data);\n      this.validateFieldSync(field, data);\n    }\n  }, {\n    key: 'makeLabels',\n    value: function makeLabels(validation, field) {\n      var _this = this;\n\n      var labels = _defineProperty({}, field.path, field.label);\n\n      (0, _forIn3.default)(validation.rules[field.path], function (rule) {\n        if (typeof rule.value === 'string' && rule.name.match(/^(required_|same|different)/)) {\n          (0, _forIn3.default)(rule.value.split(','), function (p, i) {\n            if (!rule.name.match(/^required_(if|unless)/) || i % 2 === 0) {\n              var f = _this.state.form.$(p);\n\n              if (f && f.path && f.label) {\n                labels[f.path] = f.label;\n              }\n            }\n          });\n        }\n      });\n      validation.setAttributeNames(labels);\n    }\n  }, {\n    key: 'validateFieldSync',\n    value: function validateFieldSync(field, data) {\n      var $rules = this.rules(field.rules, 'sync'); // exit if no rules found\n\n      if ((0, _isEmpty3.default)($rules[0])) return; // get field rules\n\n      var rules = _defineProperty({}, field.path, $rules); // create the validator instance\n\n\n      var validation = new this.validator(data, rules); // set label into errors messages instead key\n\n      this.makeLabels(validation, field); // check validation\n\n      if (validation.passes()) return; // the validation is failed, set the field error\n\n      field.invalidate((0, _first3.default)(validation.errors.get(field.path)));\n    }\n  }, {\n    key: 'validateFieldAsync',\n    value: function validateFieldAsync(field, data) {\n      var _this2 = this;\n\n      var $rules = this.rules(field.rules, 'async'); // exit if no rules found\n\n      if ((0, _isEmpty3.default)($rules[0])) return; // get field rules\n\n      var rules = _defineProperty({}, field.path, $rules); // create the validator instance\n\n\n      var validation = new this.validator(data, rules); // set label into errors messages instead key\n\n      this.makeLabels(validation, field);\n      var $p = new Promise(function (resolve) {\n        return validation.checkAsync(function () {\n          return _this2.handleAsyncPasses(field, resolve);\n        }, function () {\n          return _this2.handleAsyncFails(field, validation, resolve);\n        });\n      });\n      this.promises.push($p);\n    }\n  }, {\n    key: 'handleAsyncPasses',\n    value: function handleAsyncPasses(field, resolve) {\n      field.setValidationAsyncData(true);\n      field.showAsyncErrors();\n      resolve();\n    }\n  }, {\n    key: 'handleAsyncFails',\n    value: function handleAsyncFails(field, validation, resolve) {\n      field.setValidationAsyncData(false, (0, _first3.default)(validation.errors.get(field.path)));\n      this.executeAsyncValidation(field);\n      field.showAsyncErrors();\n      resolve();\n    }\n  }, {\n    key: 'executeAsyncValidation',\n    value: function executeAsyncValidation(field) {\n      if (field.validationAsyncData.valid === false) {\n        field.invalidate(field.validationAsyncData.message, true);\n      }\n    }\n  }, {\n    key: 'rules',\n    value: function rules(_rules, type) {\n      var $rules = (0, _isString3.default)(_rules) ? (0, _split3.default)(_rules, '|') : _rules; // eslint-disable-next-line new-cap\n\n      var v = new this.validator();\n      return (0, _filter3.default)($rules, function ($rule) {\n        return type === 'async' ? v.getRule((0, _split3.default)($rule, ':')[0]).async : !v.getRule((0, _split3.default)($rule, ':')[0]).async;\n      });\n    }\n  }]);\n\n  return DVR;\n}();\n\nexports.default = function (config) {\n  return {\n    class: DVR,\n    config: config\n  };\n};\n\nmodule.exports = exports['default'];","map":{"version":3,"sources":["D:/management-tool/node_modules/mobx-react-form/lib/validators/DVR.js"],"names":["Object","defineProperty","exports","value","_filter2","require","_filter3","_interopRequireDefault","_split2","_split3","_isString2","_isString3","_first2","_first3","_isEmpty2","_isEmpty3","_forIn2","_forIn3","_isFunction2","_isFunction3","_createClass","defineProperties","target","props","i","length","descriptor","enumerable","configurable","writable","key","Constructor","protoProps","staticProps","prototype","obj","__esModule","default","_defineProperty","_classCallCheck","instance","TypeError","DVR","_ref","_ref$config","config","undefined","_ref$state","state","_ref$promises","promises","extend","validator","package","extendValidator","form","validateField","field","data","validatedValues","validateFieldAsync","validateFieldSync","makeLabels","validation","_this","labels","path","label","rules","rule","name","match","split","p","f","$","setAttributeNames","$rules","passes","invalidate","errors","get","_this2","$p","Promise","resolve","checkAsync","handleAsyncPasses","handleAsyncFails","push","setValidationAsyncData","showAsyncErrors","executeAsyncValidation","validationAsyncData","valid","message","_rules","type","v","$rule","getRule","async","class","module"],"mappings":"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","sourcesContent":["'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _filter2 = require('lodash/filter');\n\nvar _filter3 = _interopRequireDefault(_filter2);\n\nvar _split2 = require('lodash/split');\n\nvar _split3 = _interopRequireDefault(_split2);\n\nvar _isString2 = require('lodash/isString');\n\nvar _isString3 = _interopRequireDefault(_isString2);\n\nvar _first2 = require('lodash/first');\n\nvar _first3 = _interopRequireDefault(_first2);\n\nvar _isEmpty2 = require('lodash/isEmpty');\n\nvar _isEmpty3 = _interopRequireDefault(_isEmpty2);\n\nvar _forIn2 = require('lodash/forIn');\n\nvar _forIn3 = _interopRequireDefault(_forIn2);\n\nvar _isFunction2 = require('lodash/isFunction');\n\nvar _isFunction3 = _interopRequireDefault(_isFunction2);\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\n/**\n  Declarative Validation Rules\n\n    const plugins = {\n      dvr: dvr({\n        package: validatorjs,\n        extend: callback,\n      }),\n    };\n\n*/\nvar DVR = function () {\n  function DVR(_ref) {\n    var _ref$config = _ref.config,\n        config = _ref$config === undefined ? {} : _ref$config,\n        _ref$state = _ref.state,\n        state = _ref$state === undefined ? {} : _ref$state,\n        _ref$promises = _ref.promises,\n        promises = _ref$promises === undefined ? [] : _ref$promises;\n\n    _classCallCheck(this, DVR);\n\n    this.promises = [];\n    this.config = null;\n    this.state = null;\n    this.extend = null;\n    this.validator = null;\n\n    this.state = state;\n    this.promises = promises;\n    this.extend = config.extend;\n    this.validator = config.package || config;\n    this.extendValidator();\n  }\n\n  _createClass(DVR, [{\n    key: 'extendValidator',\n    value: function extendValidator() {\n      // extend using \"extend\" callback\n      if ((0, _isFunction3.default)(this.extend)) {\n        this.extend({\n          validator: this.validator,\n          form: this.state.form\n        });\n      }\n    }\n  }, {\n    key: 'validateField',\n    value: function validateField(field) {\n      // get form fields data\n      var data = this.state.form.validatedValues;\n      this.validateFieldAsync(field, data);\n      this.validateFieldSync(field, data);\n    }\n  }, {\n    key: 'makeLabels',\n    value: function makeLabels(validation, field) {\n      var _this = this;\n\n      var labels = _defineProperty({}, field.path, field.label);\n      (0, _forIn3.default)(validation.rules[field.path], function (rule) {\n        if (typeof rule.value === 'string' && rule.name.match(/^(required_|same|different)/)) {\n          (0, _forIn3.default)(rule.value.split(','), function (p, i) {\n            if (!rule.name.match(/^required_(if|unless)/) || i % 2 === 0) {\n              var f = _this.state.form.$(p);\n              if (f && f.path && f.label) {\n                labels[f.path] = f.label;\n              }\n            }\n          });\n        }\n      });\n      validation.setAttributeNames(labels);\n    }\n  }, {\n    key: 'validateFieldSync',\n    value: function validateFieldSync(field, data) {\n      var $rules = this.rules(field.rules, 'sync');\n      // exit if no rules found\n      if ((0, _isEmpty3.default)($rules[0])) return;\n      // get field rules\n      var rules = _defineProperty({}, field.path, $rules);\n      // create the validator instance\n      var validation = new this.validator(data, rules);\n      // set label into errors messages instead key\n      this.makeLabels(validation, field);\n      // check validation\n      if (validation.passes()) return;\n      // the validation is failed, set the field error\n      field.invalidate((0, _first3.default)(validation.errors.get(field.path)));\n    }\n  }, {\n    key: 'validateFieldAsync',\n    value: function validateFieldAsync(field, data) {\n      var _this2 = this;\n\n      var $rules = this.rules(field.rules, 'async');\n      // exit if no rules found\n      if ((0, _isEmpty3.default)($rules[0])) return;\n      // get field rules\n      var rules = _defineProperty({}, field.path, $rules);\n      // create the validator instance\n      var validation = new this.validator(data, rules);\n      // set label into errors messages instead key\n      this.makeLabels(validation, field);\n\n      var $p = new Promise(function (resolve) {\n        return validation.checkAsync(function () {\n          return _this2.handleAsyncPasses(field, resolve);\n        }, function () {\n          return _this2.handleAsyncFails(field, validation, resolve);\n        });\n      });\n\n      this.promises.push($p);\n    }\n  }, {\n    key: 'handleAsyncPasses',\n    value: function handleAsyncPasses(field, resolve) {\n      field.setValidationAsyncData(true);\n      field.showAsyncErrors();\n      resolve();\n    }\n  }, {\n    key: 'handleAsyncFails',\n    value: function handleAsyncFails(field, validation, resolve) {\n      field.setValidationAsyncData(false, (0, _first3.default)(validation.errors.get(field.path)));\n      this.executeAsyncValidation(field);\n      field.showAsyncErrors();\n      resolve();\n    }\n  }, {\n    key: 'executeAsyncValidation',\n    value: function executeAsyncValidation(field) {\n      if (field.validationAsyncData.valid === false) {\n        field.invalidate(field.validationAsyncData.message, true);\n      }\n    }\n  }, {\n    key: 'rules',\n    value: function rules(_rules, type) {\n      var $rules = (0, _isString3.default)(_rules) ? (0, _split3.default)(_rules, '|') : _rules;\n      // eslint-disable-next-line new-cap\n      var v = new this.validator();\n      return (0, _filter3.default)($rules, function ($rule) {\n        return type === 'async' ? v.getRule((0, _split3.default)($rule, ':')[0]).async : !v.getRule((0, _split3.default)($rule, ':')[0]).async;\n      });\n    }\n  }]);\n\n  return DVR;\n}();\n\nexports.default = function (config) {\n  return {\n    class: DVR,\n    config: config\n  };\n};\n\nmodule.exports = exports['default'];"]},"metadata":{},"sourceType":"script"}