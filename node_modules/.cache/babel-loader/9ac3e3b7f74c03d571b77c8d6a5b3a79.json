{"ast":null,"code":"'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = undefined;\n\nvar _get2 = require('lodash/get');\n\nvar _get3 = _interopRequireDefault(_get2);\n\nvar _isNil2 = require('lodash/isNil');\n\nvar _isNil3 = _interopRequireDefault(_isNil2);\n\nvar _each2 = require('lodash/each');\n\nvar _each3 = _interopRequireDefault(_each2);\n\nvar _isString2 = require('lodash/isString');\n\nvar _isString3 = _interopRequireDefault(_isString2);\n\nvar _has2 = require('lodash/has');\n\nvar _has3 = _interopRequireDefault(_has2);\n\nvar _map2 = require('lodash/map');\n\nvar _map3 = _interopRequireDefault(_map2);\n\nvar _merge2 = require('lodash/merge');\n\nvar _merge3 = _interopRequireDefault(_merge2);\n\nvar _createClass = function () {\n  function defineProperties(target, props) {\n    for (var i = 0; i < props.length; i++) {\n      var descriptor = props[i];\n      descriptor.enumerable = descriptor.enumerable || false;\n      descriptor.configurable = true;\n      if (\"value\" in descriptor) descriptor.writable = true;\n      Object.defineProperty(target, descriptor.key, descriptor);\n    }\n  }\n\n  return function (Constructor, protoProps, staticProps) {\n    if (protoProps) defineProperties(Constructor.prototype, protoProps);\n    if (staticProps) defineProperties(Constructor, staticProps);\n    return Constructor;\n  };\n}();\n\nvar _desc, _value, _class, _descriptor;\n\nvar _mobx = require('mobx');\n\nvar _utils = require('./utils');\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    default: obj\n  };\n}\n\nfunction _initDefineProp(target, property, descriptor, context) {\n  if (!descriptor) return;\n  Object.defineProperty(target, property, {\n    enumerable: descriptor.enumerable,\n    configurable: descriptor.configurable,\n    writable: descriptor.writable,\n    value: descriptor.initializer ? descriptor.initializer.call(context) : void 0\n  });\n}\n\nfunction _classCallCheck(instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n}\n\nfunction _applyDecoratedDescriptor(target, property, decorators, descriptor, context) {\n  var desc = {};\n  Object['ke' + 'ys'](descriptor).forEach(function (key) {\n    desc[key] = descriptor[key];\n  });\n  desc.enumerable = !!desc.enumerable;\n  desc.configurable = !!desc.configurable;\n\n  if ('value' in desc || desc.initializer) {\n    desc.writable = true;\n  }\n\n  desc = decorators.slice().reverse().reduce(function (desc, decorator) {\n    return decorator(target, property, desc) || desc;\n  }, desc);\n\n  if (context && desc.initializer !== void 0) {\n    desc.value = desc.initializer ? desc.initializer.call(context) : void 0;\n    desc.initializer = undefined;\n  }\n\n  if (desc.initializer === void 0) {\n    Object['define' + 'Property'](target, property, desc);\n    desc = null;\n  }\n\n  return desc;\n}\n\nfunction _initializerWarningHelper(descriptor, context) {\n  throw new Error('Decorating class property failed. Please ensure that transform-class-properties is enabled.');\n}\n\nvar Validator = (_class = function () {\n  function Validator() {\n    var obj = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n\n    _classCallCheck(this, Validator);\n\n    this.promises = [];\n    this.form = {};\n    this.options = {};\n    this.drivers = {};\n    this.plugins = {\n      vjf: undefined,\n      dvr: undefined,\n      svk: undefined,\n      yup: undefined\n    };\n\n    _initDefineProp(this, 'error', _descriptor, this);\n\n    (0, _merge3.default)(this.plugins, obj.plugins);\n    this.form = obj.form;\n    this.initDrivers();\n    this.checkSVKValidationPlugin();\n  }\n\n  _createClass(Validator, [{\n    key: 'initDrivers',\n    value: function initDrivers() {\n      var _this = this;\n\n      (0, _map3.default)(this.plugins, function (driver, key) {\n        return _this.drivers[key] = driver && (0, _has3.default)(driver, 'class') && new driver.class({\n          config: driver.config,\n          state: _this.form.state,\n          promises: _this.promises\n        });\n      });\n    }\n  }, {\n    key: 'validate',\n    value: function validate() {\n      var _this2 = this;\n\n      var opt = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n      var obj = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n      var path = (0, _utils.$try)(opt.path, opt);\n      var field = (0, _utils.$try)(opt.field, this.form.select(path, null, null));\n      var related = (0, _utils.$try)(opt.related, obj.related, true);\n      var showErrors = (0, _utils.$try)(opt.showErrors, obj.showErrors, false);\n      var instance = field || this.form;\n      instance.$validating = true;\n      instance.$validated += 1;\n      this.error = null;\n      return new Promise(function (resolve) {\n        // validate instance (form or filed)\n        if (instance.path || (0, _isString3.default)(path)) {\n          _this2.validateField({\n            field: instance,\n            showErrors: showErrors,\n            related: related,\n            path: path\n          });\n        } // validate nested fields\n\n\n        instance.each(function ($field) {\n          return _this2.validateField({\n            path: $field.path,\n            field: $field,\n            showErrors: showErrors,\n            related: related\n          });\n        }); // wait all promises\n\n        resolve(Promise.all(_this2.promises));\n      }).then((0, _mobx.action)(function () {\n        instance.$validating = false;\n        instance.$clearing = false;\n        instance.$resetting = false;\n      })).catch((0, _mobx.action)(function (err) {\n        instance.$validating = false;\n        instance.$clearing = false;\n        instance.$resetting = false;\n        throw err;\n      })).then(function () {\n        return instance;\n      });\n    }\n  }, {\n    key: 'validateField',\n    value: function validateField(_ref) {\n      var _ref$showErrors = _ref.showErrors,\n          showErrors = _ref$showErrors === undefined ? false : _ref$showErrors,\n          _ref$related = _ref.related,\n          related = _ref$related === undefined ? false : _ref$related,\n          _ref$field = _ref.field,\n          field = _ref$field === undefined ? null : _ref$field,\n          path = _ref.path;\n      var instance = field || this.form.select(path); // check if the field is a valid instance\n\n      if (!instance.path) throw new Error('Validation Error: Invalid Field Instance'); // do not validate soft deleted fields\n\n      if (instance.deleted && !this.form.state.options.get('validateDeletedFields')) return; // do not validate disabled fields\n\n      if (instance.disabled && !this.form.state.options.get('validateDisabledFields')) return; // do not validate pristine fields\n\n      if (instance.isPristine && !this.form.state.options.get('validatePristineFields')) return; // reset field validation\n\n      instance.resetValidation(); // validate with all enabled drivers\n\n      (0, _each3.default)(this.drivers, function (driver) {\n        return driver && driver.validateField(instance);\n      }); // send error to the view\n\n      instance.showErrors(showErrors); // related validation\n\n      if (related) this.relatedFieldValidation(instance, showErrors);\n    }\n    /**\n      Validate 'related' fields if specified\n      and related validation allowed (recursive)\n    */\n\n  }, {\n    key: 'relatedFieldValidation',\n    value: function relatedFieldValidation(field, showErrors) {\n      var _this3 = this;\n\n      if (!field.related || !field.related.length) return;\n      (0, _each3.default)(field.related, function (path) {\n        return _this3.validateField({\n          related: false,\n          showErrors: showErrors,\n          path: path\n        });\n      });\n    }\n  }, {\n    key: 'checkSVKValidationPlugin',\n    value: function checkSVKValidationPlugin() {\n      if ((0, _isNil3.default)(this.drivers.svk) && (0, _get3.default)(this.plugins, 'svk.config.schema')) {\n        var form = this.state.form.name ? 'Form: ' + this.state.form.name : '';\n        throw new Error('The SVK validation schema is defined but no plugin provided (SVK). ' + form);\n      }\n    }\n  }]);\n\n  return Validator;\n}(), (_descriptor = _applyDecoratedDescriptor(_class.prototype, 'error', [_mobx.observable], {\n  enumerable: true,\n  initializer: function initializer() {\n    return null;\n  }\n}), _applyDecoratedDescriptor(_class.prototype, 'validate', [_mobx.action], Object.getOwnPropertyDescriptor(_class.prototype, 'validate'), _class.prototype), _applyDecoratedDescriptor(_class.prototype, 'validateField', [_mobx.action], Object.getOwnPropertyDescriptor(_class.prototype, 'validateField'), _class.prototype)), _class);\nexports.default = Validator;\nmodule.exports = exports['default'];","map":{"version":3,"sources":["D:/management-tool/node_modules/mobx-react-form/lib/Validator.js"],"names":["Object","defineProperty","exports","value","default","undefined","_get2","require","_get3","_interopRequireDefault","_isNil2","_isNil3","_each2","_each3","_isString2","_isString3","_has2","_has3","_map2","_map3","_merge2","_merge3","_createClass","defineProperties","target","props","i","length","descriptor","enumerable","configurable","writable","key","Constructor","protoProps","staticProps","prototype","_desc","_value","_class","_descriptor","_mobx","_utils","obj","__esModule","_initDefineProp","property","context","initializer","call","_classCallCheck","instance","TypeError","_applyDecoratedDescriptor","decorators","desc","forEach","slice","reverse","reduce","decorator","_initializerWarningHelper","Error","Validator","arguments","promises","form","options","drivers","plugins","vjf","dvr","svk","yup","initDrivers","checkSVKValidationPlugin","_this","driver","class","config","state","validate","_this2","opt","path","$try","field","select","related","showErrors","$validating","$validated","error","Promise","resolve","validateField","each","$field","all","then","action","$clearing","$resetting","catch","err","_ref","_ref$showErrors","_ref$related","_ref$field","deleted","get","disabled","isPristine","resetValidation","relatedFieldValidation","_this3","name","observable","getOwnPropertyDescriptor","module"],"mappings":"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","sourcesContent":["'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = undefined;\n\nvar _get2 = require('lodash/get');\n\nvar _get3 = _interopRequireDefault(_get2);\n\nvar _isNil2 = require('lodash/isNil');\n\nvar _isNil3 = _interopRequireDefault(_isNil2);\n\nvar _each2 = require('lodash/each');\n\nvar _each3 = _interopRequireDefault(_each2);\n\nvar _isString2 = require('lodash/isString');\n\nvar _isString3 = _interopRequireDefault(_isString2);\n\nvar _has2 = require('lodash/has');\n\nvar _has3 = _interopRequireDefault(_has2);\n\nvar _map2 = require('lodash/map');\n\nvar _map3 = _interopRequireDefault(_map2);\n\nvar _merge2 = require('lodash/merge');\n\nvar _merge3 = _interopRequireDefault(_merge2);\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _desc, _value, _class, _descriptor;\n\nvar _mobx = require('mobx');\n\nvar _utils = require('./utils');\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _initDefineProp(target, property, descriptor, context) {\n  if (!descriptor) return;\n  Object.defineProperty(target, property, {\n    enumerable: descriptor.enumerable,\n    configurable: descriptor.configurable,\n    writable: descriptor.writable,\n    value: descriptor.initializer ? descriptor.initializer.call(context) : void 0\n  });\n}\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _applyDecoratedDescriptor(target, property, decorators, descriptor, context) {\n  var desc = {};\n  Object['ke' + 'ys'](descriptor).forEach(function (key) {\n    desc[key] = descriptor[key];\n  });\n  desc.enumerable = !!desc.enumerable;\n  desc.configurable = !!desc.configurable;\n\n  if ('value' in desc || desc.initializer) {\n    desc.writable = true;\n  }\n\n  desc = decorators.slice().reverse().reduce(function (desc, decorator) {\n    return decorator(target, property, desc) || desc;\n  }, desc);\n\n  if (context && desc.initializer !== void 0) {\n    desc.value = desc.initializer ? desc.initializer.call(context) : void 0;\n    desc.initializer = undefined;\n  }\n\n  if (desc.initializer === void 0) {\n    Object['define' + 'Property'](target, property, desc);\n    desc = null;\n  }\n\n  return desc;\n}\n\nfunction _initializerWarningHelper(descriptor, context) {\n  throw new Error('Decorating class property failed. Please ensure that transform-class-properties is enabled.');\n}\n\nvar Validator = (_class = function () {\n  function Validator() {\n    var obj = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n\n    _classCallCheck(this, Validator);\n\n    this.promises = [];\n    this.form = {};\n    this.options = {};\n    this.drivers = {};\n    this.plugins = {\n      vjf: undefined,\n      dvr: undefined,\n      svk: undefined,\n      yup: undefined\n    };\n\n    _initDefineProp(this, 'error', _descriptor, this);\n\n    (0, _merge3.default)(this.plugins, obj.plugins);\n    this.form = obj.form;\n\n    this.initDrivers();\n    this.checkSVKValidationPlugin();\n  }\n\n  _createClass(Validator, [{\n    key: 'initDrivers',\n    value: function initDrivers() {\n      var _this = this;\n\n      (0, _map3.default)(this.plugins, function (driver, key) {\n        return _this.drivers[key] = driver && (0, _has3.default)(driver, 'class') && new driver.class({\n          config: driver.config,\n          state: _this.form.state,\n          promises: _this.promises\n        });\n      });\n    }\n  }, {\n    key: 'validate',\n    value: function validate() {\n      var _this2 = this;\n\n      var opt = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n      var obj = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n\n      var path = (0, _utils.$try)(opt.path, opt);\n      var field = (0, _utils.$try)(opt.field, this.form.select(path, null, null));\n      var related = (0, _utils.$try)(opt.related, obj.related, true);\n      var showErrors = (0, _utils.$try)(opt.showErrors, obj.showErrors, false);\n      var instance = field || this.form;\n      instance.$validating = true;\n      instance.$validated += 1;\n\n      this.error = null;\n\n      return new Promise(function (resolve) {\n        // validate instance (form or filed)\n        if (instance.path || (0, _isString3.default)(path)) {\n          _this2.validateField({\n            field: instance,\n            showErrors: showErrors,\n            related: related,\n            path: path\n          });\n        }\n\n        // validate nested fields\n        instance.each(function ($field) {\n          return _this2.validateField({\n            path: $field.path,\n            field: $field,\n            showErrors: showErrors,\n            related: related\n          });\n        });\n\n        // wait all promises\n        resolve(Promise.all(_this2.promises));\n      }).then((0, _mobx.action)(function () {\n        instance.$validating = false;\n        instance.$clearing = false;\n        instance.$resetting = false;\n      })).catch((0, _mobx.action)(function (err) {\n        instance.$validating = false;\n        instance.$clearing = false;\n        instance.$resetting = false;\n        throw err;\n      })).then(function () {\n        return instance;\n      });\n    }\n  }, {\n    key: 'validateField',\n    value: function validateField(_ref) {\n      var _ref$showErrors = _ref.showErrors,\n          showErrors = _ref$showErrors === undefined ? false : _ref$showErrors,\n          _ref$related = _ref.related,\n          related = _ref$related === undefined ? false : _ref$related,\n          _ref$field = _ref.field,\n          field = _ref$field === undefined ? null : _ref$field,\n          path = _ref.path;\n\n      var instance = field || this.form.select(path);\n      // check if the field is a valid instance\n      if (!instance.path) throw new Error('Validation Error: Invalid Field Instance');\n      // do not validate soft deleted fields\n      if (instance.deleted && !this.form.state.options.get('validateDeletedFields')) return;\n      // do not validate disabled fields\n      if (instance.disabled && !this.form.state.options.get('validateDisabledFields')) return;\n      // do not validate pristine fields\n      if (instance.isPristine && !this.form.state.options.get('validatePristineFields')) return;\n      // reset field validation\n      instance.resetValidation();\n      // validate with all enabled drivers\n      (0, _each3.default)(this.drivers, function (driver) {\n        return driver && driver.validateField(instance);\n      });\n      // send error to the view\n      instance.showErrors(showErrors);\n      // related validation\n      if (related) this.relatedFieldValidation(instance, showErrors);\n    }\n\n    /**\n      Validate 'related' fields if specified\n      and related validation allowed (recursive)\n    */\n\n  }, {\n    key: 'relatedFieldValidation',\n    value: function relatedFieldValidation(field, showErrors) {\n      var _this3 = this;\n\n      if (!field.related || !field.related.length) return;\n\n      (0, _each3.default)(field.related, function (path) {\n        return _this3.validateField({\n          related: false,\n          showErrors: showErrors,\n          path: path\n        });\n      });\n    }\n  }, {\n    key: 'checkSVKValidationPlugin',\n    value: function checkSVKValidationPlugin() {\n      if ((0, _isNil3.default)(this.drivers.svk) && (0, _get3.default)(this.plugins, 'svk.config.schema')) {\n        var form = this.state.form.name ? 'Form: ' + this.state.form.name : '';\n        throw new Error('The SVK validation schema is defined but no plugin provided (SVK). ' + form);\n      }\n    }\n  }]);\n\n  return Validator;\n}(), (_descriptor = _applyDecoratedDescriptor(_class.prototype, 'error', [_mobx.observable], {\n  enumerable: true,\n  initializer: function initializer() {\n    return null;\n  }\n}), _applyDecoratedDescriptor(_class.prototype, 'validate', [_mobx.action], Object.getOwnPropertyDescriptor(_class.prototype, 'validate'), _class.prototype), _applyDecoratedDescriptor(_class.prototype, 'validateField', [_mobx.action], Object.getOwnPropertyDescriptor(_class.prototype, 'validateField'), _class.prototype)), _class);\nexports.default = Validator;\nmodule.exports = exports['default'];"]},"metadata":{},"sourceType":"script"}