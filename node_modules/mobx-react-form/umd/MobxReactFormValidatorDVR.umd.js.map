{"version":3,"sources":["webpack:///webpack/universalModuleDefinition","webpack:///webpack/bootstrap 8a2e093fa6e28ea9e0c0","webpack:///external \"_\"","webpack:///./src/validators/DVR.js"],"names":["DVR","config","state","promises","extend","validator","package","extendValidator","_","isFunction","form","field","data","validatedValues","validateFieldAsync","validateFieldSync","validation","labels","path","label","forIn","rules","rule","value","name","match","split","p","i","f","$","setAttributeNames","$rules","isEmpty","makeLabels","passes","invalidate","first","errors","get","$p","Promise","checkAsync","handleAsyncPasses","resolve","handleAsyncFails","push","setValidationAsyncData","showAsyncErrors","executeAsyncValidation","validationAsyncData","valid","message","type","isString","v","filter","getRule","$rule","async","class"],"mappings":"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","file":"MobxReactFormValidatorDVR.umd.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory(require(\"_\"));\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([\"_\"], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"MobxReactFormValidatorDVR\"] = factory(require(\"_\"));\n\telse\n\t\troot[\"MobxReactFormValidatorDVR\"] = factory(root[\"_\"]);\n})(typeof self !== 'undefined' ? self : this, function(__WEBPACK_EXTERNAL_MODULE_0__) {\nreturn \n\n\n// WEBPACK FOOTER //\n// webpack/universalModuleDefinition"," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 20);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap 8a2e093fa6e28ea9e0c0","module.exports = __WEBPACK_EXTERNAL_MODULE_0__;\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"_\"\n// module id = 0\n// module chunks = 0 1 2 3 4","import _ from 'lodash';\n\n/**\n  Declarative Validation Rules\n\n    const plugins = {\n      dvr: dvr({\n        package: validatorjs,\n        extend: callback,\n      }),\n    };\n\n*/\nclass DVR {\n\n  promises = [];\n\n  config = null;\n\n  state = null;\n\n  extend = null;\n\n  validator = null;\n\n  constructor({\n    config = {},\n    state = {},\n    promises = [],\n  }) {\n    this.state = state;\n    this.promises = promises;\n    this.extend = config.extend;\n    this.validator = config.package || config;\n    this.extendValidator();\n  }\n\n  extendValidator() {\n    // extend using \"extend\" callback\n    if (_.isFunction(this.extend)) {\n      this.extend({\n        validator: this.validator,\n        form: this.state.form,\n      });\n    }\n  }\n\n  validateField(field) {\n    // get form fields data\n    const data = this.state.form.validatedValues;\n    this.validateFieldAsync(field, data);\n    this.validateFieldSync(field, data);\n  }\n\n  makeLabels(validation, field) {\n    const labels = { [field.path]: field.label };\n    _.forIn(validation.rules[field.path], (rule) => {\n      if (typeof rule.value === 'string' && rule.name.match(/^(required_|same|different)/)) {\n        _.forIn(rule.value.split(','), (p, i) => {\n          if (!rule.name.match(/^required_(if|unless)/) || (i % 2 === 0)) {\n            const f = this.state.form.$(p);\n            if (f && f.path && f.label) {\n              labels[f.path] = f.label;\n            }\n          }\n        });\n      }\n    });\n    validation.setAttributeNames(labels);\n  }\n\n  validateFieldSync(field, data) {\n    const $rules = this.rules(field.rules, 'sync');\n    // exit if no rules found\n    if (_.isEmpty($rules[0])) return;\n    // get field rules\n    const rules = { [field.path]: $rules };\n    // create the validator instance\n    const validation = new this.validator(data, rules);\n    // set label into errors messages instead key\n    this.makeLabels(validation, field);\n    // check validation\n    if (validation.passes()) return;\n    // the validation is failed, set the field error\n    field.invalidate(_.first(validation.errors.get(field.path)));\n  }\n\n  validateFieldAsync(field, data) {\n    const $rules = this.rules(field.rules, 'async');\n    // exit if no rules found\n    if (_.isEmpty($rules[0])) return;\n    // get field rules\n    const rules = { [field.path]: $rules };\n    // create the validator instance\n    const validation = new this.validator(data, rules);\n    // set label into errors messages instead key\n    this.makeLabels(validation, field);\n\n    const $p = new Promise(resolve =>\n      validation.checkAsync(\n        () => this.handleAsyncPasses(field, resolve),\n        () => this.handleAsyncFails(field, validation, resolve),\n      ));\n\n    this.promises.push($p);\n  }\n\n  handleAsyncPasses(field, resolve) {\n    field.setValidationAsyncData(true);\n    field.showAsyncErrors();\n    resolve();\n  }\n\n  handleAsyncFails(field, validation, resolve) {\n    field.setValidationAsyncData(false, _.first(validation.errors.get(field.path)));\n    this.executeAsyncValidation(field);\n    field.showAsyncErrors();\n    resolve();\n  }\n\n  executeAsyncValidation(field) {\n    if (field.validationAsyncData.valid === false) {\n      field.invalidate(field.validationAsyncData.message, true);\n    }\n  }\n\n\n  rules(rules, type) {\n    const $rules = _.isString(rules) ? _.split(rules, '|') : rules;\n    // eslint-disable-next-line new-cap\n    const v = new this.validator();\n    return _.filter($rules, $rule => type === 'async'\n      ? v.getRule(_.split($rule, ':')[0]).async\n      : !v.getRule(_.split($rule, ':')[0]).async);\n  }\n}\n\nexport default (config) => ({\n  class: DVR,\n  config,\n});\n\n\n\n// WEBPACK FOOTER //\n// ./src/validators/DVR.js"],"sourceRoot":""}